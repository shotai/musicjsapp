<!doctype html>
<html>

<head>
    <title>Music</title>
    <!--  <link rel="stylesheet" href="/cover.css"> -->
    <link rel="stylesheet" href="/animate-animo.css">
    <link rel="stylesheet" href="/bootstrap.min.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"> -->
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"> -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/animo.js"></script>
    <script src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>
    <script src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>
    <style type="text/css">
    .text-overflow {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 500px;
    }
    
    #artists .row {
        margin-bottom: 20px;
    }
    
    a:link {
        text-decoration: none;
    }
    
    .row .row {
        margin-top: 10px;
        margin-bottom: 0;
    }
    
    #artists [class*="col-"] {
        background-color: #eee;
        background-color: rgba(86, 61, 124, .15);
        border: 1px solid #ddd;
        border: 1px solid rgba(86, 61, 124, .2);
        height: 120px;
        overflow: hidden;
        white-space: normal;
        text-align: left;
    }
    
    .modal-body [class*="col-"] {
        border: 1px solid #ddd;
        border: 1px solid rgba(86, 61, 124, .2);
        margin-bottom: 3px;
        height: 50px;
    }
    
    .artistid {
        display: none;
    }
    
    .media-object {
        -webkit-animation: fadein 2s;
        /* Safari, Chrome and Opera > 12.1 */
        -moz-animation: fadein 1s;
        /* Firefox < 16 */
        -ms-animation: fadein 2s;
        /* Internet Explorer */
        -o-animation: fadein 2s;
        /* Opera < 12.1 */
        animation: fadein 1s;
    }
    
    @-moz-keyframes fadein {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    /* Safari, Chrome and Opera > 12.1 */
    
    @-webkit-keyframes fadein {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    /* Internet Explorer */
    
    @-ms-keyframes fadein {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    /* Opera < 12.1 */
    
    @-o-keyframes fadein {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    
    .media-left {
        width: 60%;
        height: 100%;
    }
    
    .col-md-8 {
        height: 100px;
        overflow: hidden;
    }
    
    .colblocks {
        opacity: 0;
    }
    </style>
    <script type="text/javascript" src="/frontend.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
        //var dict = {};
        var firsttime = true;
        $(".modal").each(function(index) {
            $(this).on('show.bs.modal', function(e) {
                $('.modal-dialog').velocity('transition.flipYIn');
            });
        });

        $("#searchsingertest").click(function() {
            alert("searchsingertest")
            resetthings();
            searchArtist("sam smith", function(result) {
                console.log(result);
                if (result != null) {
                    buildlist(result);
                }
            });
        });

        // $("#artists").on("click", "a.artistname", function() {

        //     var htmlString = $(this).find("p").html();
        //     var l = dict[htmlString];
        //     if (firsttime) {
        //         getartistdetail(htmlString);
        //         firsttime = false;
        //     } else {
        //         $('#artistdetail').collapse("hide");
        //         $('#artistdetail').on('hidden.bs.collapse', function() {
        //             getartistdetail(htmlString);
        //         });
        //     }
        // });

        $("#artists").on("click", "div.colblocks", function(e) {
            e.preventDefault();
            var len = $("div.colblocks").length;
            var artistname = $(this).find("#artistname").html();
            var artistid = $(this).find("p").html();

            alert(artistname);
            $("#artistModalName").html(artistname);
            getTopTracks(artistid, function(result) {
                var i = 0;
                var tmphtml="";
                console.log(result)
                $.each(result.tracks, function(index, value){
                    // var imgurl = "/spotify-logo-vertical-white-rgb.png";
                    // if (value[i].images.length > 0) {
                    //     imgurl = result[i].images[0].url;
                    // }
                    tmphtml += "<div class='col-md-10 col-md-offset-1' >" + "<h5 id='artistname'>" + value.name + "</h5>" + "<p class='artistid'>" + value.id + "</p> </div>";
                });
                $(".modal-body .row").html(tmphtml);

            })

            $("div.colblocks").each(function(index) {
                $(this).delay(150 * index).queue(function(nxt) {
                    $(this).animo({
                        animation: "fadeOutDown",
                        duration: 0.2,
                        keep: true
                    });
                    nxt();
                });
            })
            resetthings();
            console.log(artistid);
            getRelatedArtists(artistid, function(result) {
                console.log(result);
                if (result != null) {
                    buildlist(result);
                }
            });
        });
        //var html = "<div class='jumbotron'><h1>" + dict[artistid][0] + "</h1></div>";
        // $("#artists").html(html);







        // function getartistdetail(id) {
        //     if (dict.length == 0) {
        //         return
        //     }
        //     var artistname = dict[id][0];
        //     var artistimage = "";
        //     if (dict[id][1].length > 0) {
        //         artistimage = dict[id][1][0].url;
        //     } else {
        //         artistimage = "/spotify-logo-vertical-white-rgb.png";
        //     }
        //     var artistimage2 = "/spotify-logo-vertical-white-rgb.png";
        //     console.log(artistimage);



        //     var htmlString = "<div class='media-left media-top'><a href='#'><img class='media-object img-rounded' src='" + artistimage + "' alt='" + artistimage2 + "' width='200' hight='500'></a></div><div class='media-body'><h4 class='media-heading'>" + artistname + "</h4>" + "test" + "</div>";

        //     $(".media").html(htmlString);
        //     $('#artistdetail').collapse("show");
        // };

        function resetthings() {
            //dict = {};
            firsttime = true;
            $("#artists").html("");
            //$('#artistdetail').collapse("hide");
        };

        function buildlist(result) {
            if (result.length == 0) {
                return
            };
            var tmphtml = "";
            var i = 0;
            var num = 20;
            while (i < num && i < result.length) {
                var imgurl = "/spotify-logo-vertical-white-rgb.png";
                if (result[i].images.length > 0) {
                    imgurl = result[i].images[0].url;
                }
                tmphtml += "<div class='col-md-6 btn-default btn colblocks' >" + "<div class='media-left'><img class='media-object img-rounded' src='" + imgurl + "' alt='" + imgurl + "' width='80%'></div><div class='media-body'><a class='media-heading '  href='#'><h5 id='artistname'>" + result[i].name + "</h5></a></div>" + "<p class='artistid'>" + result[i].id + "</p> </div>";
                i += 1;
            };
            $("#artists").html(tmphtml);
            $("div.colblocks").each(function(index) {
                $(this).delay(150 * index).queue(function(nxt) {
                    $(this).animo({
                        animation: "fadeInUp",
                        duration: 0.2,
                        keep: true
                    });
                    nxt();
                });
            });
        };

    });
    </script>
</head>

<body>
    <div class="container">
        <div id="login">
            <button id="searchsingertest">searchsingertest</button>
            <button id="wikitest" data-toggle="modal" data-target="#artistModal">wikitest</button>
        </div>
        <div id="artists" class="row">
        </div>
        <div class="modal" id="artistModal" tabindex="-1" role="dialog" aria-labelledby="artistModalName">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="artistModalName">Modal title</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-10 col-md-offset-1">.col-md-6 .col-md-offset-3</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
